\documentclass[12pt,a4paper,twoside]{book}

% Options for packages loaded elsewhere
\PassOptionsToPackage{hyphens}{url}
%
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\usepackage{framed}

\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi

% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}

\usepackage{listings}
\newcommand{\passthrough}[1]{#1}
\lstset{defaultdialect=[5.3]Lua}
\lstset{defaultdialect=[x86masm]Assembler}

\makeatletter
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\usepackage[urlcolor=blue]{hyperref}
% \hypersetup{
%   % hidelinks,
  % pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs


\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

%% general usepackage stuff
\usepackage{times}
\usepackage{mathptmx}
\usepackage{booktabs}
\usepackage{titlesec}
\usepackage{subcaption}
\captionsetup{compatibility=false}
\usepackage{color}

%% labels and page stuff
\renewcommand{\labelitemi}{$\diamond$}
\renewcommand{\labelitemii}{$\circ$}

\setcounter{secnumdepth}{3}

\input{new_narrow_margins_x2mm.tex} %


%% todo
\newcommand{\todo}[1]{\textcolor{red}{[todo: }#1\textcolor{red}{]}}
\newcommand{\todoh}[1]{} 
\newcommand{\done}[1]{} 

%% smallerText
\newcommand{\smallerTextSize}{10}
\newcommand{\smallerTextSkip}{12}
\newcommand{\smallerBegin}{\fontsize{\smallerTextSize}{\smallerTextSkip}\selectfont}
\newcommand{\smallerEnd}{\normalsize}
\newcommand{\smaller}[1]{\smallerBegin #1\smallerEnd}

%%reference to defintion
\newcommand{\defref}[1]{\ref{#1} on page \pageref{#1}}

%% special, short for shell
\newcommand{\shl}[1]{\sf \small #1\rm\normalsize}

\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}

%% indentation in tables
\newcommand{\tabind}[1]{\rule{#1mm}{0cm}}

%% smaller in captions
\newcommand{\captionfonts}{\smallerBegin}
                                                                                                                                                                              
\makeatletter  % Allow the use of @ in command names
\long\def\@makecaption#1#2{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{{\captionfonts #1: #2}}%
  \ifdim \wd\@tempboxa >\hsize
    {\captionfonts #1: #2\par}
  \else
    \hbox to\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}
\makeatother   % Cancel the effect of \makeatletter

% % clear page before new chapter
% \makeatletter
% \def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
% \hbox{}
% \vspace*{\fill}
% \begin{center}
% %This page intentionally contains only this sentence.
% \end{center}
% \vspace{\fill}
% \thispagestyle{empty}
% \newpage
% \if@twocolumn\hbox{}\newpage\fi\fi\fi}
% \makeatother

%% abbreviations
\usepackage{nomencl}
\let\abbrev\nomenclature
\renewcommand{\nomname}{List of Abbreviations}
\setlength{\nomlabelwidth}{.25\hsize}
\renewcommand{\nomlabel}[1]{#1 \dotfill}
\setlength{\nomitemsep}{-\parsep}
\makenomenclature
\newcommand{\Listofabbrev}{
\printnomenclature
\newpage
}

%% chapter title formatting
\titleformat{\chapter}[display]{ \raggedleft }{\fontsize{52}{63}\selectfont \bf \thechapter }{0.2cm}{\fontsize{32}{38.7}\selectfont  }[]

%% haeder formatting
% \renewcommand{\chaptermark}[1]{%
% \markboth{\chaptername
% \ \thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf[LEH,ROH]{\thepage}
\fancyhf[REH]{\smaller{\nouppercase{\leftmark}}}
\fancyhf[LOH]{\smaller{\it \nouppercase{\rightmark}}}
\fancyhf[COF]{\rule{0.2cm}{0.0cm}}
\fancyhf[CEF]{\rule{0.2cm}{0.0cm}}
\renewcommand{\headrulewidth}{0pt}

%% macro for figures
%\usepackage{svg}
%\usepackage{amsmath}
%\newcommand{\printlabel}{}
%\newcommand{\abcdef}[1]{\tiny #1 \normalsize}

		%% arguments: graphics file, label, caption, smallcaption
\newcommand{\insertFigure}[4]{\begin{figure}[top] \smallerBegin \centering \includegraphics{#1}  \\  \caption{\label{#2}\smallerBegin #3 \footnotesize{#4}  \smallerEnd }  
\end{figure}	}
%% macro for figures with short caption
		%% arguments: graphics file, label, caption, smallcaption, shortcaption
\newcommand{\insertFigureShort}[5]{\begin{figure}[top] \smallerBegin \centering \includegraphics{#1} \label{#2} \\ \caption[#5]{\smallerBegin #3 \footnotesize{#4} \smallerEnd } 
\end{figure}	}
%\renewcommand{\topfraction}{1}

\newcommand{\spaceafterpar}{\vspace{14.48pt}}

\renewcommand{\floatpagefraction}{.75} % vorher: .5
\renewcommand{\textfraction}{.1}       % vorher: .2
\renewcommand{\topfraction}{.8}        % vorher: .7
\renewcommand{\bottomfraction}{.5} 
\setcounter{topnumber}{3}              % vorher: 2
\setcounter{bottomnumber}{2}           % vorher: 1
\setcounter{totalnumber}{5}            % vorher: 3
%from: http://www.matthiaspospiech.de/latex/vorlagen/allgemein/preambel/9/

%macros for tables
    %% arguments: columns
\newcommand{\tableBegin}[1]{\begin{table}[top] \begin{center} \smallerBegin \begin{tabular}{#1}}
		%% arguemtns: caption, label
\newcommand{\tableEnd}[2]{ \end{tabular} \smallerEnd \end{center} \caption{#1} \label{#2}	\end{table}}

%% shortcuts
\newcommand{\emit}[1]{\item \emph{#1}:}
\newcommand{\firstappear}[2]{\emph{#1} (#2) \abbrev{#2}{#1}}

\hyphenation{or-gan-izing}

%% definitions

\newtheorem{definition}{Definition}

%% examples
\newcommand{\exampleBeginText}[1]{\paragraph{#1}}
\newcommand{\exampleEnd}{\vspace{6mm}}
\newcommand{\exampleBegin}{\exampleBeginText{Example}}

%algorithms
\usepackage[english,ruled,vlined, slide, norelsize]{algorithm2e}

%references

\usepackage[numbers,sort]{natbib}
\setlength{\bibsep}{0.0pt}
% \bibliographystyle{plainnat}

%ref imgs


\usepackage{cleveref}

\usepackage{csvsimple}


